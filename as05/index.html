<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>當城市開始呼吸｜Progress Bar + Horizontal Reverse</title>
  <style>
    :root {
      --bg: #0c0f14;
      --fg: #e7ecf3;
      --muted: #98a2b3;
      --accent: #5eead4; /* progress */
      --accent-2: #60a5fa; /* headings */
      --card: #12161d;
    }
    html, body {
      margin: 0;
      padding: 0;
      color: var(--fg);
      background: var(--bg);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans CJK TC", "Hiragino Sans", "Microsoft JhengHei", Arial, Helvetica, sans-serif;
      line-height: 1.6;
    }
    a { color: var(--accent-2); text-decoration: none; }
    img { max-width: 100%; height: auto; display: block; }
    /* --- Global Layout Helpers --- */
    .container { width: min(1100px, 92vw); margin: 0 auto; }
    .section { padding: 12vh 0; }
    .lead { color: var(--muted); font-size: clamp(1rem, 1rem + 0.4vw, 1.25rem); }

    /* --- Progress (Left→Right) without position detection --- */
    .progress-wrap { position: sticky; top: 0; z-index: 30; background: linear-gradient(180deg, rgba(12,15,20,0.82), rgba(12,15,20,0.4)); backdrop-filter: saturate(120%) blur(6px); }
    .progress-bar { height: 4px; background: rgba(255,255,255,0.08); }
    .progress { height: 100%; width: 0%; background: linear-gradient(90deg, var(--accent), var(--accent-2)); transition: width 0.15s linear; }
    .progress-labels { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; font-size: 12px; padding: 8px 0 6px; color: var(--muted); }
    .progress-labels span { white-space: nowrap; opacity: 0.85; }

    /* --- Intro Hero --- */
    .hero { padding: 18vh 0 10vh; }
    .hero h1 { font-size: clamp(2rem, 4.8vw, 4rem); line-height: 1.1; letter-spacing: 0.4px; margin: 0 0 8px; }
    .hero p.kicker { color: var(--accent-2); text-transform: uppercase; letter-spacing: .18em; font-size: .8rem; margin: 0 0 10px; }
    .hero .sub { color: var(--muted); font-size: clamp(1rem, 1.1rem + 0.2vw, 1.3rem); max-width: 70ch; }

    /* --- Card Row for Day Timeline --- */
    .cards { display: grid; grid-template-columns: repeat(12, 1fr); gap: 20px; }
    .card { grid-column: span 6; background: var(--card); border-radius: 16px; padding: 18px; box-shadow: 0 10px 26px rgba(0,0,0,.22); }
    .card h3 { margin: 6px 0 8px; font-size: 1.2rem; color: var(--accent-2); }
    .card p { margin: 0; color: var(--fg); opacity: 0.9; }
    .card figure { margin: 0 0 12px; border-radius: 12px; overflow: hidden; }
    @media (max-width: 900px) { .card { grid-column: span 12; } }

    /* --- Horizontal Section (Reverse) --- */
    .h-wrap { position: relative; }
    .h-pin { position: sticky; top: 0; height: 100svh; display: grid; place-items: center; overflow: hidden; background: radial-gradient(1200px 600px at 50% 10%, rgba(96,165,250,.22), transparent 60%); }
    .h-stage { position: relative; width: 400vw; height: 100%; display: grid; grid-auto-flow: column; grid-auto-columns: 100vw; align-items: stretch; }
    .panel { padding: 6vh min(12vw, 60px); display: grid; grid-template-columns: 1.1fr 0.9fr; gap: min(6vw,60px); align-items: center; }
    .panel:nth-child(odd){ background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0)); }
    .panel:nth-child(even){ background: linear-gradient(180deg, rgba(255,255,255,0.025), rgba(255,255,255,0)); }
    .panel h2 { font-size: clamp(1.5rem, 2.4vw, 2.6rem); margin: 0 0 10px; }
    .panel .copy { color: var(--muted); }
    .panel .visual { border-radius: 16px; overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,.35); }
    .panel .visual img { width: 100%; height: 100%; object-fit: cover; }
    @media (max-width: 900px) { .panel { grid-template-columns: 1fr; } }

    /* Horizontal scroll progress dot nav (optional, a11y-friendly indicator) */
    .dots { position: absolute; right: 16px; top: 50%; transform: translateY(-50%); display: grid; gap: 10px; }
    .dot { width: 10px; height: 10px; border-radius: 50%; background: rgba(255,255,255,0.25); }
    .dot[aria-current="true"] { background: var(--accent-2); box-shadow: 0 0 0 6px rgba(96,165,250,.16); }

    /* --- Outro / Credits --- */
    .outro { padding: 18vh 0 24vh; text-align: center; }
    .outro .small { color: var(--muted); font-size: 0.95rem; }
    .chip { display: inline-block; padding: 6px 10px; border-radius: 999px; background: rgba(255,255,255,0.06); color: var(--muted); margin: 4px; font-size: 12px; }
  </style>
</head>
<body>
  <!-- Progress (Left→Right) without position detection: document-level scroll percent -->
  <div class="progress-wrap" role="presentation" aria-hidden="true">
    <div class="container">
      <div class="progress-bar" aria-label="頁面閱讀進度">
        <div class="progress" id="progress"></div>
      </div>
      <div class="progress-labels" aria-hidden="true">
        <span>黎明</span>
        <span>日間</span>
        <span>黃昏</span>
        <span>深夜</span>
      </div>
    </div>
  </div>

  <!-- HERO -->
  <header class="hero container section" id="top">
    <p class="kicker">City & Self</p>
    <h1>當城市開始呼吸</h1>
    <p class="sub">以 <strong>Progress Bar（左→右）</strong> 與 <strong>Horizontal Section（Reverse）</strong> 串接「城市的日夜」與「人的內心節奏」。捲動即可展開敘事，行動裝置亦支援，並納入無障礙與降低動效偏好。</p>
  </header>

  <!-- Day timeline section (ties to progress semantics) -->
  <section class="container section" aria-labelledby="dayflow">
    <h2 id="dayflow" style="color:var(--accent-2); margin-top:0">黎明 → 日間 → 黃昏 → 深夜</h2>
    <p class="lead">進度條象徵城市時間的推移；四張視覺對應情緒基調，建議以 AI 生成圖像強化意象。</p>
    <div class="cards" style="margin-top:24px">
      <!-- DAWN -->
      <article class="card" aria-labelledby="dawn">
        <figure>
          <!-- 建議以生成圖替換 src：例如以 DALL·E / MJ 生成清晨微霧城市天際線 -->
          <img src="https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=1600&auto=format&fit=crop" alt="清晨的城市天際線與薄霧" />
        </figure>
        <h3 id="dawn">黎明：霧氣翻白，第一班公車亮起</h3>
        <p class="copy">空氣裡混合著麵包與柏油味，報紙機器剛停下。城市吸一口長氣。</p>
        <div class="chip" title="AI 生成提示詞">Prompt: cinematic city at dawn, soft fog, pastel sky, wide shot</div>
      </article>
      <!-- DAY -->
      <article class="card" aria-labelledby="noon">
        <figure>
          <img src="https://images.unsplash.com/photo-1467269204594-9661b134dd2b?q=80&w=1600&auto=format&fit=crop" alt="日間的十字路口與人潮" />
        </figure>
        <h3 id="noon">日間：斑馬線鼓掌，繁忙如合奏</h3>
        <p class="copy">喇叭、解鎖聲、咖啡機蒸汽。節拍加快，人群成為城市的鼓點。</p>
        <div class="chip">Prompt: busy crosswalk midday, dynamic motion blur, cinematic</div>
      </article>
      <!-- DUSK -->
      <article class="card" aria-labelledby="dusk">
        <figure>
          <img src="https://images.unsplash.com/photo-1502920917128-1aa500764cbd?q=80&w=1600&auto=format&fit=crop" alt="夕陽照映的高樓與雲層" />
        </figure>
        <h3 id="dusk">黃昏：光線斜倚，城市換氣</h3>
        <p class="copy">落日把玻璃染成琥珀色，熄燈與開霓虹的間歇，像一次深吐。</p>
        <div class="chip">Prompt: golden hour skyline, warm glow, reflective glass, filmic</div>
      </article>
      <!-- NIGHT -->
      <article class="card" aria-labelledby="night">
        <figure>
          <img src="https://images.unsplash.com/photo-1518306727298-4c17e1bf6942?q=80&w=1600&auto=format&fit=crop" alt="夜色中的霓虹街景與反光" />
        </figure>
        <h3 id="night">深夜：霓虹呼吸，心跳變慢</h3>
        <p class="copy">路面留住雨，倒影延長了招牌的呼吸。少數窗燈，替代了白日的人聲。</p>
        <div class="chip">Prompt: neon night street after rain, reflections, moody, high contrast</div>
      </article>
    </div>
  </section>

  <!-- Horizontal Section (Reverse) : vertical scroll controls horizontal translation in reverse direction -->
  <section class="h-wrap" aria-label="內在節奏：橫向反向敘事">
    <!-- 這段外層的高度決定可滾動區域長度，4 個面板 → 設為 4 倍視窗高度（再加緩衝） -->
    <div id="h-scroll-space" style="height: 520svh;"></div>

    <div class="h-pin">
      <div class="h-stage" id="stage" aria-live="polite">
        <!-- Panel 1 -->
        <section class="panel" aria-labelledby="p1">
          <div>
            <h2 id="p1">夜歸人的腳步</h2>
            <p class="copy">有些人此刻才結束白日，有些人剛開始他們的夜。反向的滾動，像是把心事往回拉。
            </p>
          </div>
          <div class="visual"><img src="https://images.unsplash.com/photo-1475274226684-5f1d1b3d43a2?q=80&w=1600&auto=format&fit=crop" alt="夜歸的人影走過濕亮的巷口" /></div>
        </section>
        <!-- Panel 2 -->
        <section class="panel" aria-labelledby="p2">
          <div>
            <h2 id="p2">窗光的獨白</h2>
            <p class="copy">每一扇窗都是一段未說完的句子。有人讀書，有人復盤，有人只是靜坐。</p>
          </div>
          <div class="visual"><img src="https://images.unsplash.com/photo-1506377711776-0a1b43b87ada?q=80&w=1600&auto=format&fit=crop" alt="夜裡公寓的一扇黃燈窗戶特寫" /></div>
        </section>
        <!-- Panel 3 -->
        <section class="panel" aria-labelledby="p3">
          <div>
            <h2 id="p3">霓虹與心率</h2>
            <p class="copy">城市的心率隨著色彩變化。霓虹在閃爍，你的念頭也在閃爍。</p>
          </div>
          <div class="visual"><img src="https://images.unsplash.com/photo-1482192505345-5655af888cc4?q=80&w=1600&auto=format&fit=crop" alt="霓虹招牌與行人匆匆的街口" /></div>
        </section>
        <!-- Panel 4 -->
        <section class="panel" aria-labelledby="p4">
          <div>
            <h2 id="p4">凌晨四點的空白</h2>
            <p class="copy">最安靜的時刻，城市與你都在同一個深呼吸裡。反向的結束，是另一個開始。</p>
          </div>
          <div class="visual"><img src="https://images.unsplash.com/photo-1456945415000-cffed14f2fad?q=80&w=1600&auto=format&fit=crop" alt="凌晨空無一人的街道，微弱路燈" /></div>
        </section>
      </div>
      <!-- Dot indicators -->
      <div class="dots" aria-hidden="true">
        <div class="dot" id="d0" aria-current="true"></div>
        <div class="dot" id="d1"></div>
        <div class="dot" id="d2"></div>
        <div class="dot" id="d3"></div>
      </div>
    </div>
  </section>

  <!-- OUTRO -->
  <footer class="outro container">
    <h2 style="color:var(--accent-2); margin:0 0 8px">城市仍在呼吸</h2>
    <p class="small">本頁示範 <strong>Progress-bar-left-right-without-pos-detection</strong> 與 <strong>horizontal-section-reverse</strong> 的整合敘事。圖片為示意，建議以 AI 生成圖像取代：
      <em>「neon night street after rain, reflections, cinematic, 35mm, high dynamic range」</em> 等。
    </p>
  </footer>

  <script>
    // --- Progress (Left→Right) based on overall page scroll ---
    const progressEl = document.getElementById('progress');
    const updateProgress = () => {
      const h = document.documentElement;
      const max = h.scrollHeight - h.clientHeight;
      const p = max > 0 ? (h.scrollTop / max) * 100 : 0;
      progressEl.style.width = p.toFixed(2) + '%';
    };
    document.addEventListener('scroll', updateProgress, { passive: true });
    window.addEventListener('resize', updateProgress);
    updateProgress();

    // --- Horizontal Section (Reverse) ---
    // The idea: as the user scrolls through a tall spacer, we translateX the stage in the opposite direction.
    const stage = document.getElementById('stage');
    const space = document.getElementById('h-scroll-space');
    const dots = [document.getElementById('d0'), document.getElementById('d1'), document.getElementById('d2'), document.getElementById('d3')];

    const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

    function clamp(n, min, max) { return Math.max(min, Math.min(n, max)); }

    function syncHorizontal() {
      const rect = space.getBoundingClientRect();
      const viewportH = window.innerHeight;
      const totalScroll = space.offsetHeight - viewportH; // scrollable span of this section
      const progressed = clamp((0 - rect.top) / totalScroll, 0, 1); // 0..1

      // stage width spans 4 panels → translate from 0 to -300vw (i.e., move left). Reverse = invert the direction.
      const panels = 4;
      const maxTranslate = (panels - 1) * 100; // 300vw
      const reverse = 1 - progressed; // key: reverse mapping
      const tx = -maxTranslate * reverse; // e.g., start at -300vw, end at 0

      if (!prefersReduced) {
        stage.style.transform = `translate3d(${tx}vw, 0, 0)`;
      } else {
        // Reduced motion: snap by section when in viewport center
        const idx = Math.round(reverse * (panels - 1));
        stage.style.transform = `translate3d(${-idx * 100}vw, 0, 0)`;
      }

      // Update dots
      const activeIndex = clamp(Math.round((1 - reverse) * (panels - 1)), 0, panels - 1);
      dots.forEach((d, i) => d.setAttribute('aria-current', i === activeIndex ? 'true' : 'false'));
    }

    // On scroll & resize
    document.addEventListener('scroll', syncHorizontal, { passive: true });
    window.addEventListener('resize', syncHorizontal);
    // Initial
    syncHorizontal();

    // Safety: if fonts or assets load and layout shifts
    window.addEventListener('load', () => {
      updateProgress();
      syncHorizontal();
    });
  </script>
</body>
</html>
